{# Aplicativo/templates/progresso/historico_progresso.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Gráficos de Progresso – {{ apadrinhado.nome }}{% endblock %}

{% block content %}
  <h1>Gráficos de Progresso – {{ apadrinhado.nome }}</h1>

  <canvas id="graficoNotas" width="600" height="300"></canvas>
  <canvas id="graficoFrequencia" width="600" height="300" style="margin-top: 30px;"></canvas>

  <p style="margin-top: 1rem;">
    <a href="{% url 'detalhes_aluno' apadrinhado.id %}" class="btn btn-secondary">
      ← Voltar ao boletim
    </a>
  </p>

  {# Aqui já recebemos da view as strings JSON: meses_json, notas_json, frequencias_json #}
  <script>
    // Converte as strings passadas no contexto em arrays JS
    const meses = JSON.parse('{{ meses_json|escapejs }}');
    const notas = JSON.parse('{{ notas_json|escapejs }}');
    const frequencias = JSON.parse('{{ frequencias_json|escapejs }}');

    // Desenha o gráfico de Notas
    const ctxNotas = document.getElementById('graficoNotas').getContext('2d');
    new Chart(ctxNotas, {
      type: 'line',
      data: {
        labels: meses,
        datasets: [{
          label: 'Notas',
          data: notas,
          borderColor: 'blue',
          fill: false,
          tension: 0.1
        }]
      },
      options: {
        scales: { y: { min: 0, max: 10 } }
      }
    });

    // Desenha o gráfico de Frequência
    const ctxFreq = document.getElementById('graficoFrequencia').getContext('2d');
    new Chart(ctxFreq, {
      type: 'line',
      data: {
        labels: meses,
        datasets: [{
          label: 'Frequência (%)',
          data: frequencias,
          borderColor: 'green',
          fill: false,
          tension: 0.1
        }]
      },
      options: {
        scales: { y: { min: 0, max: 100 } }
      }
    });
  </script>
{% endblock %}
